<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System - Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        nav {
            display: flex;
            gap: 15px;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.3s;
        }

        nav a:hover {
            background: rgba(255,255,255,0.2);
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .docs-panel {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #f8f9fa;
        }

        .terminal-panel {
            width: 500px;
            background: #1e1e1e;
            color: #d4d4d4;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #333;
        }

        .section {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 24px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #333;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .section p {
            line-height: 1.6;
            color: #555;
            margin-bottom: 10px;
        }

        .section ul, .section ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .section li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #e83e8c;
        }

        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 15px 0;
        }

        pre code {
            background: none;
            color: #d4d4d4;
            padding: 0;
        }

        .command-example {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .command-builder {
            padding: 20px;
            background: #2d2d2d;
            border-bottom: 1px solid #444;
        }

        .command-builder h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #ccc;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 8px;
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .command-preview {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #4ec9b0;
            word-break: break-all;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .terminal-output {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .terminal-line {
            margin-bottom: 5px;
        }

        .terminal-prompt {
            color: #4ec9b0;
        }

        .terminal-output-text {
            color: #d4d4d4;
        }

        .terminal-error {
            color: #f48771;
        }

        .terminal-success {
            color: #4ec9b0;
        }

        .command-history {
            max-height: 200px;
            overflow-y: auto;
            background: #1e1e1e;
            padding: 10px;
            border-top: 1px solid #444;
        }

        .history-item {
            padding: 5px;
            cursor: pointer;
            color: #ccc;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            border-bottom: 1px solid #333;
        }

        .history-item:hover {
            background: #2d2d2d;
            color: #fff;
        }

        .examples-dropdown {
            margin-bottom: 15px;
        }

        .examples-dropdown select {
            width: 100%;
            padding: 8px;
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
            font-size: 13px;
        }

        .collapsible {
            cursor: pointer;
            user-select: none;
        }

        .collapsible::before {
            content: 'â–¶ ';
            display: inline-block;
            transition: transform 0.3s;
        }

        .collapsible.active::before {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }

        .collapsible-content.active {
            max-height: 1000px;
        }

        .copy-btn {
            background: #444;
            color: #fff;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            margin-left: 10px;
        }

        .copy-btn:hover {
            background: #555;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            .terminal-panel {
                width: 100%;
                max-height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“š Library Management System - Documentation</h1>
            <nav>
                <a href="docs.html">ðŸ“š Documentation</a>
                <a href="logs.html">ðŸ“Š Logs Dashboard</a>
            </nav>
        </header>

        <div class="main-content">
            <div class="docs-panel">
                <div class="section">
                    <h2>Introduction</h2>
                    <p>The Electronic Library Management System v1.0 is a CLI-based application built with Python that provides comprehensive library management functionality with role-based access control, JSON persistence, and centralized logging.</p>
                    
                    <h3>Key Features</h3>
                    <ul>
                        <li><strong>Role-Based Access Control:</strong> Separate permissions for librarians and users</li>
                        <li><strong>Book Management:</strong> Add, delete, update, search, and list books</li>
                        <li><strong>Borrowing System:</strong> Users can borrow and return books</li>
                        <li><strong>ISBN Validation:</strong> Validates 4-10 digit numeric IDs</li>
                        <li><strong>JSON Persistence:</strong> All data stored in JSON files with atomic writes</li>
                        <li><strong>Centralized Logging:</strong> Comprehensive logging with INFO, WARNING, and ERROR levels</li>
                        <li><strong>Input Validation:</strong> Strict validation for all operations</li>
                    </ul>
                </div>

                <div class="section">
                    <h2>Quick Start</h2>
                    <h3>Installation</h3>
                    <ol>
                        <li>Ensure Python 3.7+ is installed</li>
                        <li>No external dependencies required (uses only Python standard library)</li>
                        <li>Navigate to the project directory</li>
                    </ol>

                    <h3>Basic Usage</h3>
                    <p>All commands use the <code>main.py</code> script:</p>
                    <pre><code>python main.py &lt;command&gt; [options]</code></pre>

                    <h3>First Steps</h3>
                    <ol>
                        <li>Register a user: <code>python main.py register-user --username alice --role user</code></li>
                        <li>Register a librarian: <code>python main.py register-user --username bob --role librarian</code></li>
                        <li>Add a book (as librarian): <code>python main.py add-book --title "Book Title" --author "Author" --isbn "1234" --role librarian</code></li>
                    </ol>
                </div>

                <div class="section">
                    <h2>Command Reference</h2>
                    
                    <h3 class="collapsible" onclick="toggleCollapse(this)">1. register-user</h3>
                    <div class="collapsible-content">
                        <p>Register a new user in the system. No role restriction.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py register-user --username &lt;username&gt; --role &lt;librarian|user&gt;</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py register-user --username alice --role user
python main.py register-user --username librarian1 --role librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">2. add-book (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Add a new book to the library. Requires librarian role.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py add-book --title &lt;title&gt; --author &lt;author&gt; --isbn &lt;isbn&gt; --role librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py add-book --title "The Great Gatsby" --author "F. Scott Fitzgerald" --isbn "0743273567" --role librarian</code></pre>
                        <p><strong>Note:</strong> ISBN must be 4-10 digits.</p>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">3. delete-book (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Delete a book from the library. Requires librarian role.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py delete-book --id &lt;book-uuid&gt; --role librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py delete-book --id 252d8186-5c88-4da2-bef7-80b610ba4c1b --role librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">4. update-book (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Update book information. Requires librarian role. At least one field must be provided.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py update-book --id &lt;book-uuid&gt; [--title &lt;title&gt;] [--author &lt;author&gt;] [--isbn &lt;isbn&gt;] --role librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py update-book --id 252d8186-5c88-4da2-bef7-80b610ba4c1b --title "New Title" --role librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">5. search (Librarian & User)</h3>
                    <div class="collapsible-content">
                        <p>Search books by title, author, or ISBN. Available to both roles.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py search --query &lt;search-term&gt; --role &lt;librarian|user&gt;</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py search --query "Gatsby" --role user</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">6. borrow (User Only)</h3>
                    <div class="collapsible-content">
                        <p>Borrow a book. Requires user role.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py borrow --id &lt;book-uuid&gt; --username &lt;username&gt; --role user</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py borrow --id 252d8186-5c88-4da2-bef7-80b610ba4c1b --username alice --role user</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">7. return (User Only)</h3>
                    <div class="collapsible-content">
                        <p>Return a borrowed book. Requires user role.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py return --id &lt;book-uuid&gt; --role user</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py return --id 252d8186-5c88-4da2-bef7-80b610ba4c1b --role user</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">8. list-available (Librarian & User)</h3>
                    <div class="collapsible-content">
                        <p>List all available books. Available to both roles.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py list-available --role &lt;librarian|user&gt;</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py list-available --role user</code></pre>
                    </div>
                </div>

                <div class="section">
                    <h2>Architecture</h2>
                    <p>The system follows a layered architecture with clear separation of concerns:</p>
                    <div class="mermaid">
                        graph TD
                            A[CLI Layer] --> B[Service Layer]
                            B --> C[Validation Layer]
                            C --> D[Storage Layer]
                            B --> E[Logging Layer]
                            D --> F[JSON Files]
                            E --> G[Log Files]
                    </div>
                    <h3>Layers</h3>
                    <ul>
                        <li><strong>CLI Layer:</strong> Argparse command interface</li>
                        <li><strong>Service Layer:</strong> Business logic (book_service, user_service, borrow_service)</li>
                        <li><strong>Validation Layer:</strong> Input validation (ISBN, book data, user data)</li>
                        <li><strong>Storage Layer:</strong> JSON persistence (book_storage, user_storage)</li>
                        <li><strong>Logging Layer:</strong> Centralized logging system</li>
                    </ul>
                </div>

                <div class="section">
                    <h2>Integration Guide</h2>
                    <h3>Using the CLI in Scripts</h3>
                    <p>You can integrate the CLI into your own scripts using subprocess:</p>
                    <pre><code>import subprocess

result = subprocess.run(
    ['python', 'main.py', 'add-book', 
     '--title', 'Book Title',
     '--author', 'Author Name',
     '--isbn', '1234',
     '--role', 'librarian'],
    capture_output=True,
    text=True
)

print(result.stdout)
if result.returncode != 0:
    print(f"Error: {result.stderr}")</code></pre>

                    <h3>Data Files</h3>
                    <ul>
                        <li><code>data/books.json</code>: All book data</li>
                        <li><code>data/users.json</code>: All user data</li>
                        <li><code>logs/library.log</code>: System logs</li>
                    </ul>
                </div>

                <div class="section">
                    <h2>Troubleshooting</h2>
                    <h3>Common Issues</h3>
                    <ul>
                        <li><strong>Import Errors:</strong> Make sure you're running from the project root directory</li>
                        <li><strong>Permission Errors:</strong> Check that you're using the correct role for each command</li>
                        <li><strong>ISBN Errors:</strong> Ensure ISBN is 4-10 digits (numeric only)</li>
                        <li><strong>Book Not Found:</strong> Verify the book ID is correct and exists</li>
                        <li><strong>Book Already Borrowed:</strong> Check book status before borrowing</li>
                    </ul>
                </div>
            </div>

            <div class="terminal-panel">
                <div class="command-builder">
                    <h3>Interactive Command Builder</h3>
                    
                    <div class="examples-dropdown">
                        <select id="example-select" onchange="loadExample()">
                            <option value="">Select Example Command...</option>
                            <option value="register-user">Register User</option>
                            <option value="add-book">Add Book</option>
                            <option value="delete-book">Delete Book</option>
                            <option value="update-book">Update Book</option>
                            <option value="search">Search Books</option>
                            <option value="borrow">Borrow Book</option>
                            <option value="return">Return Book</option>
                            <option value="list-available">List Available</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Command</label>
                        <select id="command-select" onchange="updateCommandBuilder()">
                            <option value="">Select Command...</option>
                            <option value="register-user">register-user</option>
                            <option value="add-book">add-book</option>
                            <option value="delete-book">delete-book</option>
                            <option value="update-book">update-book</option>
                            <option value="search">search</option>
                            <option value="borrow">borrow</option>
                            <option value="return">return</option>
                            <option value="list-available">list-available</option>
                        </select>
                    </div>

                    <div id="command-fields"></div>

                    <div class="command-preview" id="command-preview"></div>

                    <button class="btn btn-primary" onclick="executeCommand()">â–¶ Execute</button>
                    <button class="btn btn-secondary" onclick="clearTerminal()">Clear</button>
                </div>

                <div class="terminal-output" id="terminal-output">
                    <div class="terminal-line">
                        <span class="terminal-prompt">$</span>
                        <span class="terminal-output-text"> Welcome to Library Management System CLI</span>
                    </div>
                    <div class="terminal-line">
                        <span class="terminal-output-text">Select a command above to get started.</span>
                    </div>
                </div>

                <div class="command-history" id="command-history">
                    <div style="padding: 5px; color: #888; font-size: 11px; border-bottom: 1px solid #444;">Command History</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
        let commandHistory = [];

        function toggleCollapse(element) {
            element.classList.toggle('active');
            const content = element.nextElementSibling;
            content.classList.toggle('active');
        }

        function updateCommandBuilder() {
            const command = document.getElementById('command-select').value;
            const fieldsDiv = document.getElementById('command-fields');
            const previewDiv = document.getElementById('command-preview');

            if (!command) {
                fieldsDiv.innerHTML = '';
                previewDiv.textContent = '';
                return;
            }

            let fieldsHTML = '';
            let previewParts = ['python', 'main.py', command];

            switch(command) {
                case 'register-user':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="field-username" oninput="updatePreview()" placeholder="alice">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="field-role" onchange="updatePreview()">
                                <option value="user">user</option>
                                <option value="librarian">librarian</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'add-book':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="field-title" oninput="updatePreview()" placeholder="Book Title">
                        </div>
                        <div class="form-group">
                            <label>Author</label>
                            <input type="text" id="field-author" oninput="updatePreview()" placeholder="Author Name">
                        </div>
                        <div class="form-group">
                            <label>ISBN (4-10 digits)</label>
                            <input type="text" id="field-isbn" oninput="updatePreview()" placeholder="1234">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="field-role" onchange="updatePreview()">
                                <option value="librarian">librarian</option>
                                <option value="user">user</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'delete-book':
                case 'return':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Book ID (UUID)</label>
                            <input type="text" id="field-id" oninput="updatePreview()" placeholder="252d8186-5c88-4da2-bef7-80b610ba4c1b">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="field-role" onchange="updatePreview()">
                                <option value="librarian">librarian</option>
                                <option value="user">user</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'update-book':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Book ID (UUID)</label>
                            <input type="text" id="field-id" oninput="updatePreview()" placeholder="252d8186-5c88-4da2-bef7-80b610ba4c1b">
                        </div>
                        <div class="form-group">
                            <label>Title (optional)</label>
                            <input type="text" id="field-title" oninput="updatePreview()" placeholder="New Title">
                        </div>
                        <div class="form-group">
                            <label>Author (optional)</label>
                            <input type="text" id="field-author" oninput="updatePreview()" placeholder="New Author">
                        </div>
                        <div class="form-group">
                            <label>ISBN (optional)</label>
                            <input type="text" id="field-isbn" oninput="updatePreview()" placeholder="1234">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="field-role" onchange="updatePreview()">
                                <option value="librarian">librarian</option>
                                <option value="user">user</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'search':
                case 'list-available':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>${command === 'search' ? 'Query' : 'Role'}</label>
                            ${command === 'search' 
                                ? '<input type="text" id="field-query" oninput="updatePreview()" placeholder="Search term">'
                                : '<select id="field-role" onchange="updatePreview()"><option value="librarian">librarian</option><option value="user">user</option></select>'}
                        </div>
                        ${command === 'search' 
                            ? '<div class="form-group"><label>Role</label><select id="field-role" onchange="updatePreview()"><option value="librarian">librarian</option><option value="user">user</option></select></div>'
                            : ''}
                    `;
                    break;
                case 'borrow':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Book ID (UUID)</label>
                            <input type="text" id="field-id" oninput="updatePreview()" placeholder="252d8186-5c88-4da2-bef7-80b610ba4c1b">
                        </div>
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="field-username" oninput="updatePreview()" placeholder="alice">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="field-role" onchange="updatePreview()">
                                <option value="user">user</option>
                                <option value="librarian">librarian</option>
                            </select>
                        </div>
                    `;
                    break;
            }

            fieldsDiv.innerHTML = fieldsHTML;
            updatePreview();
        }

        function updatePreview() {
            const command = document.getElementById('command-select').value;
            if (!command) return;

            let preview = `python main.py ${command}`;
            const args = [];

            switch(command) {
                case 'register-user':
                    const username = document.getElementById('field-username')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (username) args.push('--username', username);
                    if (role) args.push('--role', role);
                    break;
                case 'add-book':
                    const title = document.getElementById('field-title')?.value;
                    const author = document.getElementById('field-author')?.value;
                    const isbn = document.getElementById('field-isbn')?.value;
                    const addRole = document.getElementById('field-role')?.value;
                    if (title) args.push('--title', title);
                    if (author) args.push('--author', author);
                    if (isbn) args.push('--isbn', isbn);
                    if (addRole) args.push('--role', addRole);
                    break;
                case 'delete-book':
                case 'return':
                    const id = document.getElementById('field-id')?.value;
                    const delRole = document.getElementById('field-role')?.value;
                    if (id) args.push('--id', id);
                    if (delRole) args.push('--role', delRole);
                    break;
                case 'update-book':
                    const upId = document.getElementById('field-id')?.value;
                    const upTitle = document.getElementById('field-title')?.value;
                    const upAuthor = document.getElementById('field-author')?.value;
                    const upIsbn = document.getElementById('field-isbn')?.value;
                    const upRole = document.getElementById('field-role')?.value;
                    if (upId) args.push('--id', upId);
                    if (upTitle) args.push('--title', upTitle);
                    if (upAuthor) args.push('--author', upAuthor);
                    if (upIsbn) args.push('--isbn', upIsbn);
                    if (upRole) args.push('--role', upRole);
                    break;
                case 'search':
                    const query = document.getElementById('field-query')?.value;
                    const searchRole = document.getElementById('field-role')?.value;
                    if (query) args.push('--query', query);
                    if (searchRole) args.push('--role', searchRole);
                    break;
                case 'list-available':
                    const listRole = document.getElementById('field-role')?.value;
                    if (listRole) args.push('--role', listRole);
                    break;
                case 'borrow':
                    const borId = document.getElementById('field-id')?.value;
                    const borUsername = document.getElementById('field-username')?.value;
                    const borRole = document.getElementById('field-role')?.value;
                    if (borId) args.push('--id', borId);
                    if (borUsername) args.push('--username', borUsername);
                    if (borRole) args.push('--role', borRole);
                    break;
            }

            preview += ' ' + args.join(' ');
            document.getElementById('command-preview').textContent = preview;
        }

        function loadExample() {
            const example = document.getElementById('example-select').value;
            if (!example) return;

            document.getElementById('command-select').value = example;
            updateCommandBuilder();

            // Pre-fill with example data
            switch(example) {
                case 'register-user':
                    document.getElementById('field-username').value = 'alice';
                    document.getElementById('field-role').value = 'user';
                    break;
                case 'add-book':
                    document.getElementById('field-title').value = 'The Great Gatsby';
                    document.getElementById('field-author').value = 'F. Scott Fitzgerald';
                    document.getElementById('field-isbn').value = '1234';
                    break;
                case 'search':
                    document.getElementById('field-query').value = 'Gatsby';
                    break;
            }
            updatePreview();
        }

        async function executeCommand() {
            const command = document.getElementById('command-select').value;
            if (!command) {
                addTerminalOutput('Please select a command first.', 'error');
                return;
            }

            let args = [];  // FIXED: Changed from const to let
            const commandMap = {
                'register-user': () => {
                    const username = document.getElementById('field-username')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (!username || !role) return null;
                    return ['--username', username, '--role', role];
                },
                'add-book': () => {
                    const title = document.getElementById('field-title')?.value;
                    const author = document.getElementById('field-author')?.value;
                    const isbn = document.getElementById('field-isbn')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (!title || !author || !isbn || !role) return null;
                    return ['--title', title, '--author', author, '--isbn', isbn, '--role', role];
                },
                'delete-book': () => {
                    const id = document.getElementById('field-id')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (!id || !role) return null;
                    return ['--id', id, '--role', role];
                },
                'update-book': () => {
                    const id = document.getElementById('field-id')?.value;
                    const role = document.getElementById('field-role')?.value;
                    const title = document.getElementById('field-title')?.value;
                    const author = document.getElementById('field-author')?.value;
                    const isbn = document.getElementById('field-isbn')?.value;
                    if (!id || !role) return null;
                    const result = ['--id', id, '--role', role];
                    if (title) result.push('--title', title);
                    if (author) result.push('--author', author);
                    if (isbn) result.push('--isbn', isbn);
                    return result;
                },
                'search': () => {
                    const query = document.getElementById('field-query')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (!query || !role) return null;
                    return ['--query', query, '--role', role];
                },
                'borrow': () => {
                    const id = document.getElementById('field-id')?.value;
                    const username = document.getElementById('field-username')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (!id || !username || !role) return null;
                    return ['--id', id, '--username', username, '--role', role];
                },
                'return': () => {
                    const id = document.getElementById('field-id')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (!id || !role) return null;
                    return ['--id', id, '--role', role];
                },
                'list-available': () => {
                    const role = document.getElementById('field-role')?.value;
                    if (!role) return null;
                    return ['--role', role];
                }
            };

            args = commandMap[command]();
            if (!args) {
                addTerminalOutput('Please fill in all required fields.', 'error');
                return;
            }

            const fullCommand = `python main.py ${command} ${args.join(' ')}`;
            addTerminalOutput(fullCommand, 'prompt');
            addTerminalOutput('Executing...', 'text');

            // Add to history
            commandHistory.unshift(fullCommand);
            updateHistory();

            try {
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: command,
                        args: args
                    })
                });

                const result = await response.json();

                if (result.success) {
                    if (result.stdout) {
                        addTerminalOutput(result.stdout, 'success');
                    }
                } else {
                    if (result.stderr) {
                        addTerminalOutput(result.stderr, 'error');
                    }
                    if (result.stdout) {
                        addTerminalOutput(result.stdout, 'text');
                    }
                    if (result.error) {
                        addTerminalOutput(result.error, 'error');
                    }
                }
            } catch (error) {
                addTerminalOutput(`Error: ${error.message}`, 'error');
            }
        }

        function addTerminalOutput(text, type = 'text') {
            const output = document.getElementById('terminal-output');
            const line = document.createElement('div');
            line.className = 'terminal-line';

            if (type === 'prompt') {
                line.innerHTML = `<span class="terminal-prompt">$</span> <span class="terminal-output-text">${escapeHtml(text)}</span>`;
            } else if (type === 'success') {
                line.innerHTML = `<span class="terminal-success">${escapeHtml(text)}</span>`;
            } else if (type === 'error') {
                line.innerHTML = `<span class="terminal-error">${escapeHtml(text)}</span>`;
            } else {
                line.innerHTML = `<span class="terminal-output-text">${escapeHtml(text)}</span>`;
            }

            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        function clearTerminal() {
            document.getElementById('terminal-output').innerHTML = `
                <div class="terminal-line">
                    <span class="terminal-prompt">$</span>
                    <span class="terminal-output-text"> Terminal cleared</span>
                </div>
            `;
        }

        function updateHistory() {
            const historyDiv = document.getElementById('command-history');
            const historyItems = commandHistory.slice(0, 10).map(cmd => 
                `<div class="history-item" onclick="loadFromHistory('${escapeHtml(cmd)}')">${escapeHtml(cmd)}</div>`
            ).join('');
            historyDiv.innerHTML = '<div style="padding: 5px; color: #888; font-size: 11px; border-bottom: 1px solid #444;">Command History</div>' + historyItems;
        }

        function loadFromHistory(cmd) {
            // Parse command and populate fields
            const parts = cmd.split(' ');
            if (parts.length < 3) return;
            
            const command = parts[2];
            document.getElementById('command-select').value = command;
            updateCommandBuilder();
            
            // Try to extract arguments (simplified)
            addTerminalOutput(`Loading: ${cmd}`, 'text');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>