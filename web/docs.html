<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System - Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        nav {
            display: flex;
            gap: 15px;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.3s;
        }

        nav a:hover {
            background: rgba(255,255,255,0.2);
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .docs-panel {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #f8f9fa;
        }

        .terminal-panel {
            width: 500px;
            background: #1e1e1e;
            color: #d4d4d4;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #333;
        }

        .section {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 24px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #333;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .command-example {
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
        }

        .command-example code {
            background: transparent;
            color: #333;
            font-size: 13px;
        }

        pre, code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        pre {
            padding: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }

        pre code {
            padding: 0;
            background: transparent;
        }

        ul, ol {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        li {
            margin-bottom: 8px;
        }

        .collapsible {
            cursor: pointer;
            user-select: none;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 10px;
            transition: background 0.2s;
        }

        .collapsible:hover {
            background: #efefef;
        }

        .collapsible.active {
            background: #667eea;
            color: white;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.active {
            max-height: 2000px;
            transition: max-height 0.3s ease-in;
        }

        .command-builder {
            padding: 15px;
            border-bottom: 1px solid #444;
            flex-shrink: 0;
        }

        .command-builder h3 {
            color: #d4d4d4;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            color: #888;
            font-size: 12px;
            margin-bottom: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 6px 8px;
            background: #2d2d2d;
            color: #d4d4d4;
            border: 1px solid #444;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: #333;
        }

        .command-preview {
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 3px;
            padding: 8px;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 11px;
            color: #90ee90;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 20px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 5px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #444;
            color: #d4d4d4;
        }

        .btn-secondary:hover {
            background: #555;
        }

        .terminal-output {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #1e1e1e;
            border-top: 1px solid #444;
        }

        .terminal-line {
            color: #d4d4d4;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .terminal-prompt {
            color: #90ee90;
        }

        .terminal-success {
            color: #90ee90;
        }

        .terminal-error {
            color: #ff6b6b;
        }

        .terminal-output-text {
            color: #d4d4d4;
        }

        .command-history {
            padding: 10px;
            border-top: 1px solid #444;
            max-height: 150px;
            overflow-y: auto;
            font-size: 11px;
        }

        .history-item {
            padding: 4px;
            color: #666;
            cursor: pointer;
            border-radius: 2px;
            margin-bottom: 2px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .history-item:hover {
            background: #333;
            color: #999;
        }

        .examples-dropdown {
            margin-bottom: 15px;
        }

        .examples-dropdown select {
            width: 100%;
            padding: 8px;
            background: #2d2d2d;
            color: #d4d4d4;
            border: 1px solid #444;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“š Library Management System - Documentation</h1>
            <nav>
                <a href="docs.html">ðŸ“š Documentation</a>
                <a href="logs.html">ðŸ“Š Logs Dashboard</a>
            </nav>
        </header>

        <div class="main-content">
            <div class="docs-panel">
                <div class="section">
                    <h2>Introduction</h2>
                    <p>The Electronic Library Management System v2.0 is a CLI-based application built with Python that provides comprehensive library management functionality with role-based access control, unified book identification (ID + TITLE + AUTHOR), JSON persistence, and centralized logging.</p>
                    
                    <h3>Key Features</h3>
                    <ul>
                        <li><strong>Role-Based Access Control:</strong> Separate permissions for librarians and users</li>
                        <li><strong>Book Management:</strong> Add, delete, update, and list books</li>
                        <li><strong>Borrowing Workflow:</strong> Users can pick books â†’ Librarians approve and return</li>
                        <li><strong>Unified Book ID:</strong> 4-10 digit numeric IDs with title and author</li>
                        <li><strong>JSON Persistence:</strong> All data stored in JSON files with atomic writes</li>
                        <li><strong>Centralized Logging:</strong> Comprehensive logging with INFO, WARNING, and ERROR levels</li>
                        <li><strong>Input Validation:</strong> Strict validation for all operations</li>
                    </ul>
                </div>

                <div class="section">
                    <h2>Quick Start</h2>
                    <h3>Installation</h3>
                    <ol>
                        <li>Ensure Python 3.8+ is installed</li>
                        <li>No external dependencies required (uses only Python standard library)</li>
                        <li>Navigate to the project directory</li>
                    </ol>

                    <h3>Basic Usage</h3>
                    <p>All commands use the <code>main.py</code> script:</p>
                    <pre><code>python main.py &lt;command&gt; [options]</code></pre>

                    <h3>First Steps</h3>
                    <ol>
                        <li>Register a user: <code>python main.py register-user --username alice --role user</code></li>
                        <li>Register a librarian: <code>python main.py register-user --username bob --role librarian</code></li>
                        <li>Add a book (as librarian): <code>python main.py add-book --id 1001 --title "Python 101" --author "John Doe" --librarian</code></li>
                    </ol>
                </div>

                <div class="section">
                    <h2>Command Reference</h2>
                    
                    <h3 class="collapsible" onclick="toggleCollapse(this)">1. register-user</h3>
                    <div class="collapsible-content">
                        <p>Register a new user in the system. No role restriction.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py register-user --username &lt;username&gt; --role &lt;librarian|user&gt;</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py register-user --username alice --role user
python main.py register-user --username bob --role librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">2. add-book (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Add a new book to the library. Requires librarian role.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py add-book --id &lt;4-10 digits&gt; --title &lt;title&gt; --author &lt;author&gt; --librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py add-book --id 1001 --title "The Great Gatsby" --author "F. Scott Fitzgerald" --librarian</code></pre>
                        <p><strong>Note:</strong> Book ID must be 4-10 digits (numeric).</p>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">3. delete-book (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Delete a book from the library. Requires librarian role.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py delete-book --id &lt;book-id&gt; --librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py delete-book --id 1001 --librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">4. update-book (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Update book information. Requires librarian role. At least one field must be provided.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py update-book --id &lt;book-id&gt; [--title &lt;title&gt;] [--author &lt;author&gt;] --librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py update-book --id 1001 --title "New Title" --librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">5. update-status (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Update book status. Available statuses: Available, Picked, Borrowed.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py update-status --id &lt;book-id&gt; --status &lt;Available|Picked|Borrowed&gt; --librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py update-status --id 1001 --status Available --librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">6. list-books (Both Roles)</h3>
                    <div class="collapsible-content">
                        <p>List all books in the library. Available to both users and librarians.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py list-books [--username &lt;username&gt;|--librarian]</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py list-books --librarian
python main.py list-books --username alice</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">7. pick-book (User Only)</h3>
                    <div class="collapsible-content">
                        <p>Pick (reserve) an available book for borrowing. Changes book status to Picked.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py pick-book --id &lt;book-id&gt; --username &lt;username&gt;</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py pick-book --id 1001 --username alice</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">8. list-picked (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>List all books that have been picked by users (reserved for borrowing).</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py list-picked --librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py list-picked --librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">9. approve-borrow (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Approve a picked book for borrowing. Changes book status to Borrowed.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py approve-borrow --id &lt;book-id&gt; --librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py approve-borrow --id 1001 --librarian</code></pre>
                    </div>

                    <h3 class="collapsible" onclick="toggleCollapse(this)">10. return-book (Librarian Only)</h3>
                    <div class="collapsible-content">
                        <p>Return a borrowed book to the library. Changes book status to Available.</p>
                        <div class="command-example">
                            <strong>Usage:</strong><br>
                            <code>python main.py return-book --id &lt;book-id&gt; --librarian</code>
                        </div>
                        <p><strong>Example:</strong></p>
                        <pre><code>python main.py return-book --id 1001 --librarian</code></pre>
                    </div>
                </div>

                <div class="section">
                    <h2>Borrowing Workflow</h2>
                    <p>The borrowing process involves three main steps:</p>
                    <ol>
                        <li><strong>User Picks:</strong> User reserves an available book (changes status to Picked)</li>
                        <li><strong>Librarian Approves:</strong> Librarian reviews and approves the borrowing (changes status to Borrowed)</li>
                        <li><strong>Librarian Returns:</strong> Librarian marks book as returned (changes status to Available)</li>
                    </ol>
                    <div class="mermaid">
                        graph LR
                            A[Available] -->|User picks| B[Picked]
                            B -->|Librarian approves| C[Borrowed]
                            C -->|Librarian returns| A
                    </div>
                </div>

                <div class="section">
                    <h2>Architecture</h2>
                    <p>The system follows a layered architecture with clear separation of concerns:</p>
                    <div class="mermaid">
                        graph TD
                            A[CLI Layer] --> B[Service Layer]
                            B --> C[Validation Layer]
                            C --> D[Storage Layer]
                            B --> E[Logging Layer]
                            D --> F[JSON Files]
                            E --> G[Log Files]
                    </div>
                    <h3>Layers</h3>
                    <ul>
                        <li><strong>CLI Layer:</strong> Argparse command interface</li>
                        <li><strong>Service Layer:</strong> Business logic (book_service, user_service, borrow_service)</li>
                        <li><strong>Validation Layer:</strong> Input validation (ID validation, book data, user data)</li>
                        <li><strong>Storage Layer:</strong> JSON persistence (book_storage, user_storage)</li>
                        <li><strong>Logging Layer:</strong> Centralized logging system</li>
                    </ul>
                </div>

                <div class="section">
                    <h2>Integration Guide</h2>
                    <h3>Using the CLI in Scripts</h3>
                    <p>You can integrate the CLI into your own scripts using subprocess:</p>
                    <pre><code>import subprocess

result = subprocess.run(
    ['python', 'main.py', 'add-book', 
     '--id', '1001',
     '--title', 'Book Title',
     '--author', 'Author Name',
     '--librarian'],
    capture_output=True,
    text=True
)

print(result.stdout)
if result.returncode != 0:
    print(f"Error: {result.stderr}")</code></pre>

                    <h3>Data Files</h3>
                    <ul>
                        <li><code>data/books.json</code>: All book data</li>
                        <li><code>data/users.json</code>: All user data</li>
                        <li><code>logs/library.log</code>: System logs</li>
                    </ul>
                </div>

                <div class="section">
                    <h2>Troubleshooting</h2>
                    <h3>Common Issues</h3>
                    <ul>
                        <li><strong>Import Errors:</strong> Make sure you're running from the project root directory</li>
                        <li><strong>Permission Errors:</strong> Check that you're using the correct role for each command (--librarian or --username)</li>
                        <li><strong>ID Validation Errors:</strong> Ensure ID is 4-10 digits (numeric only)</li>
                        <li><strong>Book Not Found:</strong> Verify the book ID is correct and exists</li>
                        <li><strong>Book Already Picked:</strong> Check book status before picking</li>
                        <li><strong>User Not Found:</strong> Ensure the user is registered before picking books</li>
                    </ul>
                </div>
            </div>

            <div class="terminal-panel">
                <div class="command-builder">
                    <h3>Interactive Command Builder</h3>
                    
                    <div class="examples-dropdown">
                        <select id="example-select" onchange="loadExample()">
                            <option value="">Select Example Command...</option>
                            <option value="register-user">Register User</option>
                            <option value="add-book">Add Book</option>
                            <option value="delete-book">Delete Book</option>
                            <option value="update-book">Update Book</option>
                            <option value="list-books">List Books</option>
                            <option value="pick-book">Pick Book</option>
                            <option value="approve-borrow">Approve Borrow</option>
                            <option value="return-book">Return Book</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Command</label>
                        <select id="command-select" onchange="updateCommandBuilder()">
                            <option value="">Select Command...</option>
                            <option value="register-user">register-user</option>
                            <option value="add-book">add-book</option>
                            <option value="delete-book">delete-book</option>
                            <option value="update-book">update-book</option>
                            <option value="update-status">update-status</option>
                            <option value="list-books">list-books</option>
                            <option value="pick-book">pick-book</option>
                            <option value="list-picked">list-picked</option>
                            <option value="approve-borrow">approve-borrow</option>
                            <option value="return-book">return-book</option>
                        </select>
                    </div>

                    <div id="command-fields"></div>

                    <div class="command-preview" id="command-preview"></div>

                    <button class="btn btn-primary" onclick="executeCommand()">â–¶ Execute</button>
                    <button class="btn btn-secondary" onclick="clearTerminal()">Clear</button>
                </div>

                <div class="terminal-output" id="terminal-output">
                    <div class="terminal-line">
                        <span class="terminal-prompt">$</span>
                        <span class="terminal-output-text"> Welcome to Library Management System CLI</span>
                    </div>
                    <div class="terminal-line">
                        <span class="terminal-output-text">Select a command above to get started.</span>
                    </div>
                </div>

                <div class="command-history" id="command-history">
                    <div style="padding: 5px; color: #888; font-size: 11px; border-bottom: 1px solid #444;">Command History</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
        let commandHistory = [];

        function toggleCollapse(element) {
            element.classList.toggle('active');
            const content = element.nextElementSibling;
            content.classList.toggle('active');
        }

        function updateCommandBuilder() {
            const command = document.getElementById('command-select').value;
            const fieldsDiv = document.getElementById('command-fields');
            const previewDiv = document.getElementById('command-preview');

            if (!command) {
                fieldsDiv.innerHTML = '';
                previewDiv.textContent = '';
                return;
            }

            let fieldsHTML = '';

            switch(command) {
                case 'register-user':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="field-username" oninput="updatePreview()" placeholder="alice">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="field-role" onchange="updatePreview()">
                                <option value="user">user</option>
                                <option value="librarian">librarian</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'add-book':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Book ID (4-10 digits)</label>
                            <input type="text" id="field-id" oninput="updatePreview()" placeholder="1001">
                        </div>
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="field-title" oninput="updatePreview()" placeholder="Book Title">
                        </div>
                        <div class="form-group">
                            <label>Author</label>
                            <input type="text" id="field-author" oninput="updatePreview()" placeholder="Author Name">
                        </div>
                        <div class="form-group">
                            <label>Librarian Mode</label>
                            <select id="field-librarian" onchange="updatePreview()">
                                <option value="yes">Yes (--librarian)</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'delete-book':
                case 'approve-borrow':
                case 'return-book':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Book ID</label>
                            <input type="text" id="field-id" oninput="updatePreview()" placeholder="1001">
                        </div>
                        <div class="form-group">
                            <label>Librarian Mode</label>
                            <select id="field-librarian" onchange="updatePreview()">
                                <option value="yes">Yes (--librarian)</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'update-book':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Book ID</label>
                            <input type="text" id="field-id" oninput="updatePreview()" placeholder="1001">
                        </div>
                        <div class="form-group">
                            <label>Title (optional)</label>
                            <input type="text" id="field-title" oninput="updatePreview()" placeholder="New Title">
                        </div>
                        <div class="form-group">
                            <label>Author (optional)</label>
                            <input type="text" id="field-author" oninput="updatePreview()" placeholder="New Author">
                        </div>
                        <div class="form-group">
                            <label>Librarian Mode</label>
                            <select id="field-librarian" onchange="updatePreview()">
                                <option value="yes">Yes (--librarian)</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'update-status':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Book ID</label>
                            <input type="text" id="field-id" oninput="updatePreview()" placeholder="1001">
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select id="field-status" onchange="updatePreview()">
                                <option value="Available">Available</option>
                                <option value="Picked">Picked</option>
                                <option value="Borrowed">Borrowed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Librarian Mode</label>
                            <select id="field-librarian" onchange="updatePreview()">
                                <option value="yes">Yes (--librarian)</option>
                            </select>
                        </div>
                    `;
                    break;
                case 'list-books':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>User Type</label>
                            <select id="field-user-type" onchange="updatePreview()">
                                <option value="librarian">Librarian (--librarian)</option>
                                <option value="user">User (--username)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label id="user-label">Username</label>
                            <input type="text" id="field-username" oninput="updatePreview()" placeholder="alice">
                        </div>
                    `;
                    break;
                case 'pick-book':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Book ID</label>
                            <input type="text" id="field-id" oninput="updatePreview()" placeholder="1001">
                        </div>
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="field-username" oninput="updatePreview()" placeholder="alice">
                        </div>
                    `;
                    break;
                case 'list-picked':
                    fieldsHTML = `
                        <div class="form-group">
                            <label>Librarian Mode</label>
                            <select id="field-librarian" onchange="updatePreview()">
                                <option value="yes">Yes (--librarian)</option>
                            </select>
                        </div>
                    `;
                    break;
            }

            fieldsDiv.innerHTML = fieldsHTML;
            updatePreview();
        }

        function updatePreview() {
            const command = document.getElementById('command-select').value;
            if (!command) return;

            let preview = `python main.py ${command}`;
            const args = [];

            switch(command) {
                case 'register-user':
                    const username = document.getElementById('field-username')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (username) args.push('--username', username);
                    if (role) args.push('--role', role);
                    break;
                case 'add-book':
                    const id = document.getElementById('field-id')?.value;
                    const title = document.getElementById('field-title')?.value;
                    const author = document.getElementById('field-author')?.value;
                    if (id) args.push('--id', id);
                    if (title) args.push('--title', title);
                    if (author) args.push('--author', author);
                    args.push('--librarian');
                    break;
                case 'delete-book':
                case 'approve-borrow':
                case 'return-book':
                    const delId = document.getElementById('field-id')?.value;
                    if (delId) args.push('--id', delId);
                    args.push('--librarian');
                    break;
                case 'update-book':
                    const upId = document.getElementById('field-id')?.value;
                    const upTitle = document.getElementById('field-title')?.value;
                    const upAuthor = document.getElementById('field-author')?.value;
                    if (upId) args.push('--id', upId);
                    if (upTitle) args.push('--title', upTitle);
                    if (upAuthor) args.push('--author', upAuthor);
                    args.push('--librarian');
                    break;
                case 'update-status':
                    const sId = document.getElementById('field-id')?.value;
                    const status = document.getElementById('field-status')?.value;
                    if (sId) args.push('--id', sId);
                    if (status) args.push('--status', status);
                    args.push('--librarian');
                    break;
                case 'list-books':
                    const userType = document.getElementById('field-user-type')?.value;
                    if (userType === 'librarian') {
                        args.push('--librarian');
                    } else {
                        const uname = document.getElementById('field-username')?.value;
                        if (uname) args.push('--username', uname);
                    }
                    break;
                case 'pick-book':
                    const pId = document.getElementById('field-id')?.value;
                    const pUsername = document.getElementById('field-username')?.value;
                    if (pId) args.push('--id', pId);
                    if (pUsername) args.push('--username', pUsername);
                    break;
                case 'list-picked':
                    args.push('--librarian');
                    break;
            }

            preview += ' ' + args.join(' ');
            document.getElementById('command-preview').textContent = preview;
        }

        function loadExample() {
            const example = document.getElementById('example-select').value;
            if (!example) return;

            document.getElementById('command-select').value = example;
            updateCommandBuilder();

            switch(example) {
                case 'register-user':
                    document.getElementById('field-username').value = 'alice';
                    document.getElementById('field-role').value = 'user';
                    break;
                case 'add-book':
                    document.getElementById('field-id').value = '1001';
                    document.getElementById('field-title').value = 'The Great Gatsby';
                    document.getElementById('field-author').value = 'F. Scott Fitzgerald';
                    break;
                case 'pick-book':
                    document.getElementById('field-id').value = '1001';
                    document.getElementById('field-username').value = 'alice';
                    break;
            }
            updatePreview();
        }

        async function executeCommand() {
            const command = document.getElementById('command-select').value;
            if (!command) {
                addTerminalOutput('Please select a command first.', 'error');
                return;
            }

            let args = [];
            const commandMap = {
                'register-user': () => {
                    const username = document.getElementById('field-username')?.value;
                    const role = document.getElementById('field-role')?.value;
                    if (!username || !role) return null;
                    return ['--username', username, '--role', role];
                },
                'add-book': () => {
                    const id = document.getElementById('field-id')?.value;
                    const title = document.getElementById('field-title')?.value;
                    const author = document.getElementById('field-author')?.value;
                    if (!id || !title || !author) return null;
                    return ['--id', id, '--title', title, '--author', author, '--librarian'];
                },
                'delete-book': () => {
                    const id = document.getElementById('field-id')?.value;
                    if (!id) return null;
                    return ['--id', id, '--librarian'];
                },
                'update-book': () => {
                    const id = document.getElementById('field-id')?.value;
                    if (!id) return null;
                    const result = ['--id', id];
                    const title = document.getElementById('field-title')?.value;
                    const author = document.getElementById('field-author')?.value;
                    if (title) result.push('--title', title);
                    if (author) result.push('--author', author);
                    result.push('--librarian');
                    return result;
                },
                'update-status': () => {
                    const id = document.getElementById('field-id')?.value;
                    const status = document.getElementById('field-status')?.value;
                    if (!id || !status) return null;
                    return ['--id', id, '--status', status, '--librarian'];
                },
                'list-books': () => {
                    const userType = document.getElementById('field-user-type')?.value;
                    if (userType === 'librarian') {
                        return ['--librarian'];
                    } else {
                        const username = document.getElementById('field-username')?.value;
                        if (!username) return null;
                        return ['--username', username];
                    }
                },
                'pick-book': () => {
                    const id = document.getElementById('field-id')?.value;
                    const username = document.getElementById('field-username')?.value;
                    if (!id || !username) return null;
                    return ['--id', id, '--username', username];
                },
                'list-picked': () => {
                    return ['--librarian'];
                },
                'approve-borrow': () => {
                    const id = document.getElementById('field-id')?.value;
                    if (!id) return null;
                    return ['--id', id, '--librarian'];
                },
                'return-book': () => {
                    const id = document.getElementById('field-id')?.value;
                    if (!id) return null;
                    return ['--id', id, '--librarian'];
                }
            };

            args = commandMap[command]();
            if (!args) {
                addTerminalOutput('Please fill in all required fields.', 'error');
                return;
            }

            const fullCommand = `python main.py ${command} ${args.join(' ')}`;
            addTerminalOutput(fullCommand, 'prompt');
            addTerminalOutput('Executing...', 'text');

            commandHistory.unshift(fullCommand);
            updateHistory();

            try {
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: command,
                        args: args
                    })
                });

                const result = await response.json();

                if (result.success) {
                    if (result.stdout) {
                        addTerminalOutput(result.stdout, 'success');
                    }
                } else {
                    if (result.stderr) {
                        addTerminalOutput(result.stderr, 'error');
                    }
                    if (result.stdout) {
                        addTerminalOutput(result.stdout, 'text');
                    }
                    if (result.error) {
                        addTerminalOutput(result.error, 'error');
                    }
                }
            } catch (error) {
                addTerminalOutput(`Error: ${error.message}`, 'error');
            }
        }

        function addTerminalOutput(text, type = 'text') {
            const output = document.getElementById('terminal-output');
            const line = document.createElement('div');
            line.className = 'terminal-line';

            if (type === 'prompt') {
                line.innerHTML = `<span class="terminal-prompt">$</span> <span class="terminal-output-text">${escapeHtml(text)}</span>`;
            } else if (type === 'success') {
                line.innerHTML = `<span class="terminal-success">${escapeHtml(text)}</span>`;
            } else if (type === 'error') {
                line.innerHTML = `<span class="terminal-error">${escapeHtml(text)}</span>`;
            } else {
                line.innerHTML = `<span class="terminal-output-text">${escapeHtml(text)}</span>`;
            }

            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        function clearTerminal() {
            document.getElementById('terminal-output').innerHTML = `
                <div class="terminal-line">
                    <span class="terminal-prompt">$</span>
                    <span class="terminal-output-text"> Terminal cleared</span>
                </div>
            `;
        }

        function updateHistory() {
            const historyDiv = document.getElementById('command-history');
            const historyItems = commandHistory.slice(0, 10).map(cmd => 
                `<div class="history-item" onclick="loadFromHistory('${escapeHtml(cmd)}')">${escapeHtml(cmd)}</div>`
            ).join('');
            historyDiv.innerHTML = '<div style="padding: 5px; color: #888; font-size: 11px; border-bottom: 1px solid #444;">Command History</div>' + historyItems;
        }

        function loadFromHistory(cmd) {
            const parts = cmd.split(' ');
            if (parts.length < 3) return;
            
            const command = parts[2];
            document.getElementById('command-select').value = command;
            updateCommandBuilder();
            
            addTerminalOutput(`Loading: ${cmd}`, 'text');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
